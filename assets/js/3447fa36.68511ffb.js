"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8873],{8709(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"caracalCore/deployment/production","title":"Production Guide","description":"This guide covers production-specific considerations for deploying Caracal Core.","source":"@site/docs/caracalCore/deployment/production.md","sourceDirName":"caracalCore/deployment","slug":"/caracalCore/deployment/production","permalink":"/caracalCore/deployment/production","draft":false,"unlisted":false,"editUrl":"https://github.com/Garudex-Labs/Caracal/tree/main/docs/docs/caracalCore/deployment/production.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Production Guide"},"sidebar":"caracalSidebar","previous":{"title":"Kubernetes Advanced","permalink":"/caracalCore/deployment/kubernetesAdvanced"},"next":{"title":"Operational Runbook","permalink":"/caracalCore/deployment/operationalRunbook"}}');var s=r(4848),t=r(8453);const l={sidebar_position:4,title:"Production Guide"},a="Production Deployment Guide",c={},o=[{value:"Production Architecture",id:"Production-Architecture",level:2},{value:"Recommended Architecture",id:"Recommended-Architecture",level:3},{value:"Infrastructure Requirements",id:"Infrastructure-Requirements",level:2},{value:"Minimum Production Requirements",id:"Minimum-Production-Requirements",level:3},{value:"Recommended Configuration",id:"Recommended-Configuration",level:3},{value:"Security Best Practices",id:"Security-Best-Practices",level:2},{value:"Network Security",id:"Network-Security",level:3},{value:"Secrets Management",id:"Secrets-Management",level:3},{value:"Encryption",id:"Encryption",level:3},{value:"High Availability",id:"High-Availability",level:2},{value:"Multi-AZ Deployment",id:"Multi-AZ-Deployment",level:3},{value:"Pod Disruption Budgets",id:"Pod-Disruption-Budgets",level:3},{value:"Database High Availability",id:"Database-High-Availability",level:3},{value:"Performance Tuning",id:"Performance-Tuning",level:2},{value:"Gateway Proxy Tuning",id:"Gateway-Proxy-Tuning",level:3},{value:"Monitoring and Alerting",id:"Monitoring-and-Alerting",level:2},{value:"Key Metrics",id:"Key-Metrics",level:3},{value:"Alerting Rules",id:"Alerting-Rules",level:3},{value:"Disaster Recovery",id:"Disaster-Recovery",level:2},{value:"Backup Strategy",id:"Backup-Strategy",level:3},{value:"Recovery Procedures",id:"Recovery-Procedures",level:3},{value:"Capacity Planning",id:"Capacity-Planning",level:2},{value:"Sizing Guidelines",id:"Sizing-Guidelines",level:3},{value:"Storage Growth",id:"Storage-Growth",level:3},{value:"Scaling Triggers",id:"Scaling-Triggers",level:3},{value:"Next Steps",id:"Next-Steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"Production-Deployment-Guide",children:"Production Deployment Guide"})}),"\n",(0,s.jsx)(n.p,{children:"This guide covers production-specific considerations for deploying Caracal Core."}),"\n",(0,s.jsx)(n.h2,{id:"Production-Architecture",children:"Production Architecture"}),"\n",(0,s.jsx)(n.h3,{id:"Recommended-Architecture",children:"Recommended Architecture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"                    Load Balancer (AWS ALB/NLB)\n                             |\n         +-------------------+-------------------+\n         |                   |                   |\n         v                   v                   v\n+---------------+   +---------------+   +---------------+\n| Gateway       |   | Gateway       |   | Gateway       |\n| (AZ-1)        |   | (AZ-2)        |   | (AZ-3)        |\n+-------+-------+   +-------+-------+   +-------+-------+\n         |                   |                   |\n         +---------+---------+---------+---------+\n                             |\n                             |\n         +-------------------+-------------------+\n         |                   |                   |\n         v                   v                   v\n+---------------+   +---------------+   +---------------+\n| RDS PostgreSQL|   | ElastiCache   |   | RDS PostgreSQL|\n| (Multi-AZ)    |   | Redis         |   |               |\n+---------------+   +---------------+   +---------------+\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Infrastructure-Requirements",children:"Infrastructure Requirements"}),"\n",(0,s.jsx)(n.h3,{id:"Minimum-Production-Requirements",children:"Minimum Production Requirements"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Kubernetes Cluster"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"3+ worker nodes across 3 availability zones"}),"\n",(0,s.jsx)(n.li,{children:"Node size: 8 vCPU, 32 GB RAM minimum"}),"\n",(0,s.jsx)(n.li,{children:"Total cluster capacity: 24+ vCPU, 96+ GB RAM"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Managed Services"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PostgreSQL: db.r5.xlarge or equivalent (4 vCPU, 32 GB RAM)"}),"\n",(0,s.jsx)(n.li,{children:"Redis: cache.r5.large or equivalent (2 vCPU, 13 GB RAM)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Storage"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PostgreSQL: 500 GB SSD (gp3), auto-scaling enabled"}),"\n",(0,s.jsx)(n.li,{children:"Redis: 50 GB memory"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"Recommended-Configuration",children:"Recommended Configuration"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Gateway Proxy"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Replicas: 5-10 (autoscaling)"}),"\n",(0,s.jsx)(n.li,{children:"CPU: 1000m request, 4000m limit"}),"\n",(0,s.jsx)(n.li,{children:"Memory: 1Gi request, 4Gi limit"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"Security-Best-Practices",children:"Security Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"Network-Security",children:"Network Security"}),"\n",(0,s.jsx)(n.p,{children:"Deploy all services in private subnets with properly configured security groups:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"securityGroups:\n  gateway:\n    ingress:\n      - port: 8443\n        source: load-balancer-sg\n    egress:\n      - port: 5432\n        destination: postgres-sg\n  \n  postgres:\n    ingress:\n      - port: 5432\n        source: gateway-sg, consumer-sg\n"})}),"\n",(0,s.jsx)(n.h3,{id:"Secrets-Management",children:"Secrets Management"}),"\n",(0,s.jsx)(n.p,{children:"Use external secrets management:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"AWS Secrets Manager"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: caracal-secrets\nspec:\n  secretStoreRef:\n    name: aws-secrets-manager\n  target:\n    name: caracal-secrets\n  data:\n    - secretKey: DB_PASSWORD\n      remoteRef:\n        key: caracal/production/db-password\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"HashiCorp Vault"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'apiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: caracal-vault-secrets\nspec:\n  provider: vault\n  parameters:\n    vaultAddress: "https://vault.example.com"\n    roleName: "caracal-role"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"Encryption",children:"Encryption"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"At Rest"}),": Enable encryption for PostgreSQL, Redis, and Kubernetes volumes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"In Transit"}),": All services communicate over TLS"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"High-Availability",children:"High Availability"}),"\n",(0,s.jsx)(n.h3,{id:"Multi-AZ-Deployment",children:"Multi-AZ Deployment"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"affinity:\n  podAntiAffinity:\n    requiredDuringSchedulingIgnoredDuringExecution:\n      - labelSelector:\n          matchExpressions:\n            - key: app.kubernetes.io/component\n              operator: In\n              values:\n                - gateway\n        topologyKey: topology.kubernetes.io/zone\n"})}),"\n",(0,s.jsx)(n.h3,{id:"Pod-Disruption-Budgets",children:"Pod Disruption Budgets"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: caracal-gateway-pdb\nspec:\n  minAvailable: 3\n  selector:\n    matchLabels:\n      app.kubernetes.io/component: gateway\n"})}),"\n",(0,s.jsx)(n.h3,{id:"Database-High-Availability",children:"Database High Availability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Enable Multi-AZ deployment for PostgreSQL"}),"\n",(0,s.jsx)(n.li,{children:"Configure automatic failover"}),"\n",(0,s.jsx)(n.li,{children:"Set up read replicas for read scaling"}),"\n",(0,s.jsx)(n.li,{children:"Use connection pooling (PgBouncer)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"Performance-Tuning",children:"Performance Tuning"}),"\n",(0,s.jsx)(n.h3,{id:"Gateway-Proxy-Tuning",children:"Gateway Proxy Tuning"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"gateway:\n  config:\n    dbPoolSize: 20\n    dbMaxOverflow: 10\n    dbPoolTimeout: 30\n    maxConcurrentRequests: 1000\n    requestTimeout: 30\n    policyCacheTTL: 60\n    policyCacheMaxSize: 50000\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Monitoring-and-Alerting",children:"Monitoring and Alerting"}),"\n",(0,s.jsx)(n.h3,{id:"Key-Metrics",children:"Key Metrics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Request rate (requests/sec)"}),"\n",(0,s.jsx)(n.li,{children:"Request latency (p50, p95, p99)"}),"\n",(0,s.jsx)(n.li,{children:"Error rate (%)"}),"\n",(0,s.jsx)(n.li,{children:"Database connection count"}),"\n",(0,s.jsx)(n.li,{children:"Merkle batch size and processing time"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"Alerting-Rules",children:"Alerting Rules"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'groups:\n  - name: caracal-alerts\n    rules:\n      - alert: HighErrorRate\n        expr: rate(caracal_requests_total{status="error"}[5m]) > 0.05\n        for: 5m\n        \n      - alert: MerkleVerificationFailure\n        expr: caracal_merkle_verification_failures_total > 0\n        for: 1m\n'})}),"\n",(0,s.jsx)(n.h2,{id:"Disaster-Recovery",children:"Disaster Recovery"}),"\n",(0,s.jsx)(n.h3,{id:"Backup-Strategy",children:"Backup Strategy"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PostgreSQL: Automated daily backups, 30-day retention"}),"\n",(0,s.jsx)(n.li,{children:"Configuration: Store all manifests in Git"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"Recovery-Procedures",children:"Recovery Procedures"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Database Recovery"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"aws rds restore-db-instance-from-db-snapshot \\\n  --db-instance-identifier caracal-restored \\\n  --db-snapshot-identifier caracal-snapshot-latest\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Snapshot Recovery"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"caracal snapshot restore --snapshot-id snapshot-latest\ncaracal replay start --from-snapshot snapshot-latest\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Capacity-Planning",children:"Capacity Planning"}),"\n",(0,s.jsx)(n.h3,{id:"Sizing-Guidelines",children:"Sizing Guidelines"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Events/sec"}),(0,s.jsx)(n.th,{children:"Deployment Size"}),(0,s.jsx)(n.th,{children:"Resources"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1,000"}),(0,s.jsx)(n.td,{children:"Small"}),(0,s.jsx)(n.td,{children:"Current config"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"10,000"}),(0,s.jsx)(n.td,{children:"Medium"}),(0,s.jsx)(n.td,{children:"2x resources"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"100,000"}),(0,s.jsx)(n.td,{children:"Large"}),(0,s.jsx)(n.td,{children:"10x resources"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"Storage-Growth",children:"Storage Growth"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Ledger events: ~1 KB per event"}),"\n",(0,s.jsx)(n.li,{children:"Monthly growth: events/sec x 2.6M x 3 KB"}),"\n",(0,s.jsx)(n.li,{children:"Example: 10,000 events/sec = 78 GB/month"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"Scaling-Triggers",children:"Scaling Triggers"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scale Up When"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"CPU utilization > 70% for 10 minutes"}),"\n",(0,s.jsx)(n.li,{children:"Memory utilization > 80% for 10 minutes"}),"\n",(0,s.jsx)(n.li,{children:"Request latency p99 > 1 second"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"Next-Steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./operationalRunbook",children:"Operational Runbook"})," - Day-to-day operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./dockerCompose",children:"Docker Compose"})," - Local development"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./kubernetes",children:"Kubernetes"})," - Kubernetes deployment"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>l,x:()=>a});var i=r(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);