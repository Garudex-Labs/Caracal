"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8985],{7344(e,s,r){r.r(s),r.d(s,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"caracalCore/deployment/dockerCompose","title":"Docker Compose Deployment","description":"This guide covers deploying Caracal Core using Docker Compose with PostgreSQL, Gateway Proxy, and MCP Adapter services.","source":"@site/docs/caracalCore/deployment/dockerCompose.md","sourceDirName":"caracalCore/deployment","slug":"/caracalCore/deployment/dockerCompose","permalink":"/caracalCore/deployment/dockerCompose","draft":false,"unlisted":false,"editUrl":"https://github.com/Garudex-Labs/Caracal/tree/main/docs/docs/caracalCore/deployment/dockerCompose.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Docker Compose Deployment"},"sidebar":"caracalSidebar","previous":{"title":"MCP Adapter Decorator -- SDK Plugin Mode","permalink":"/caracalCore/apiReference/mcpDecorators"},"next":{"title":"Kubernetes Deployment","permalink":"/caracalCore/deployment/kubernetes"}}');var c=r(4848),t=r(8453);const a={sidebar_position:1,title:"Docker Compose Deployment"},i="Docker Compose Deployment",o={},l=[{value:"Prerequisites",id:"Prerequisites",level:2},{value:"Quick Start",id:"Quick-Start",level:2},{value:"1. Clone and Navigate",id:"1-Clone-and-Navigate",level:3},{value:"2. Create Environment File",id:"2-Create-Environment-File",level:3},{value:"3. Certificate Setup",id:"3-Certificate-Setup",level:3},{value:"4. Start Services",id:"4-Start-Services",level:3},{value:"5. Initialize Database",id:"5-Initialize-Database",level:3},{value:"6. Verify Services",id:"6-Verify-Services",level:3},{value:"Service Endpoints",id:"Service-Endpoints",level:2},{value:"Common Commands",id:"Common-Commands",level:2},{value:"Service Management",id:"Service-Management",level:3},{value:"Logs and Debugging",id:"Logs-and-Debugging",level:3},{value:"CLI Commands",id:"CLI-Commands",level:3},{value:"Database Operations",id:"Database-Operations",level:3},{value:"Troubleshooting",id:"Troubleshooting",level:2},{value:"Services Won&#39;t Start",id:"Services-Wont-Start",level:3},{value:"Database Connection Errors",id:"Database-Connection-Errors",level:3},{value:"TLS Certificate Errors",id:"TLS-Certificate-Errors",level:3},{value:"Production Checklist",id:"Production-Checklist",level:2},{value:"Next Steps",id:"Next-Steps",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.header,{children:(0,c.jsx)(s.h1,{id:"Docker-Compose-Deployment",children:"Docker Compose Deployment"})}),"\n",(0,c.jsx)(s.p,{children:"This guide covers deploying Caracal Core using Docker Compose with PostgreSQL, Gateway Proxy, and MCP Adapter services."}),"\n",(0,c.jsx)(s.h2,{id:"Prerequisites",children:"Prerequisites"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsx)(s.li,{children:"Docker 20.10+ and Docker Compose 1.29+"}),"\n",(0,c.jsx)(s.li,{children:"At least 4GB RAM available for containers"}),"\n",(0,c.jsx)(s.li,{children:"TLS certificates for gateway proxy"}),"\n"]}),"\n",(0,c.jsx)(s.h2,{id:"Quick-Start",children:"Quick Start"}),"\n",(0,c.jsx)(s.h3,{id:"1-Clone-and-Navigate",children:"1. Clone and Navigate"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"git clone https://github.com/Garudex-Labs/Caracal.git\ncd Caracal\n"})}),"\n",(0,c.jsx)(s.h3,{id:"2-Create-Environment-File",children:"2. Create Environment File"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"cp .env.example .env\n"})}),"\n",(0,c.jsxs)(s.p,{children:["Edit ",(0,c.jsx)(s.code,{children:".env"})," and set your configuration:"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"# Change the database password in production\nDB_PASSWORD=your_secure_password_here\n\n# Configure authentication mode (mtls, jwt, or api_key)\nAUTH_MODE=jwt\n\n# Optional: Configure MCP servers\nMCP_SERVERS=local:http://localhost:3000\n"})}),"\n",(0,c.jsx)(s.h3,{id:"3-Certificate-Setup",children:"3. Certificate Setup"}),"\n",(0,c.jsxs)(s.p,{children:["Create a ",(0,c.jsx)(s.code,{children:"certs"})," directory with TLS certificates:"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"mkdir -p certs\n"})}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.strong,{children:"Development (Self-Signed):"})}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:'# Generate CA certificate\nopenssl req -x509 -newkey rsa:4096 -keyout certs/ca.key -out certs/ca.crt \\\n  -days 365 -nodes -subj "/CN=Caracal CA"\n\n# Generate server certificate\nopenssl req -newkey rsa:4096 -keyout certs/server.key -out certs/server.csr \\\n  -nodes -subj "/CN=localhost"\n\nopenssl x509 -req -in certs/server.csr -CA certs/ca.crt -CAkey certs/ca.key \\\n  -CAcreateserial -out certs/server.crt -days 365\n\n# Generate JWT key pair\nopenssl genrsa -out certs/jwt_private.pem 4096\nopenssl rsa -in certs/jwt_private.pem -pubout -out certs/jwt_public.pem\n\nrm certs/server.csr\n'})}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.strong,{children:"Production:"})," Copy your production certificates to the ",(0,c.jsx)(s.code,{children:"certs"})," directory."]}),"\n",(0,c.jsx)(s.h3,{id:"4-Start-Services",children:"4. Start Services"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"docker-compose up -d\ndocker-compose logs -f\n"})}),"\n",(0,c.jsx)(s.h3,{id:"5-Initialize-Database",children:"5. Initialize Database"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"docker-compose exec postgres pg_isready -U caracal\ndocker-compose exec gateway caracal db init\n"})}),"\n",(0,c.jsx)(s.h3,{id:"6-Verify-Services",children:"6. Verify Services"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"docker-compose ps\ncurl -k https://localhost:8443/health\ncurl http://localhost:8080/health\n"})}),"\n",(0,c.jsx)(s.h2,{id:"Service-Endpoints",children:"Service Endpoints"}),"\n",(0,c.jsxs)(s.table,{children:[(0,c.jsx)(s.thead,{children:(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.th,{children:"Service"}),(0,c.jsx)(s.th,{children:"URL"}),(0,c.jsx)(s.th,{children:"Description"})]})}),(0,c.jsxs)(s.tbody,{children:[(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"Gateway HTTPS"}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"https://localhost:8443"})}),(0,c.jsx)(s.td,{children:"Main API gateway"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"Gateway Health"}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"https://localhost:8443/health"})}),(0,c.jsx)(s.td,{children:"Health check"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"MCP Adapter"}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"http://localhost:8080"})}),(0,c.jsx)(s.td,{children:"MCP protocol adapter"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"Prometheus"}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"http://localhost:9090/metrics"})}),(0,c.jsx)(s.td,{children:"Metrics endpoint"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:"PostgreSQL"}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"localhost:5432"})}),(0,c.jsx)(s.td,{children:"Database"})]})]})]}),"\n",(0,c.jsx)(s.h2,{id:"Common-Commands",children:"Common Commands"}),"\n",(0,c.jsx)(s.h3,{id:"Service-Management",children:"Service Management"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"docker-compose up -d          # Start services\ndocker-compose stop           # Stop services\ndocker-compose down           # Remove containers\ndocker-compose down -v        # Remove containers and volumes\ndocker-compose restart        # Restart all services\n"})}),"\n",(0,c.jsx)(s.h3,{id:"Logs-and-Debugging",children:"Logs and Debugging"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"docker-compose logs -f                    # All logs\ndocker-compose logs -f gateway            # Gateway logs\ndocker-compose logs --tail=100 gateway    # Last 100 lines\n"})}),"\n",(0,c.jsx)(s.h3,{id:"CLI-Commands",children:"CLI Commands"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"docker-compose exec gateway caracal agent list\ndocker-compose exec gateway caracal policy list\ndocker-compose exec gateway caracal ledger summary\n"})}),"\n",(0,c.jsx)(s.h3,{id:"Database-Operations",children:"Database Operations"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"# Access database\ndocker-compose exec postgres psql -U caracal -d caracal\n\n# Backup\ndocker-compose exec postgres pg_dump -U caracal caracal > backup.sql\n\n# Restore\ndocker-compose exec -T postgres psql -U caracal caracal < backup.sql\n"})}),"\n",(0,c.jsx)(s.h2,{id:"Troubleshooting",children:"Troubleshooting"}),"\n",(0,c.jsx)(s.h3,{id:"Services-Wont-Start",children:"Services Won't Start"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["Check Docker versions: ",(0,c.jsx)(s.code,{children:"docker --version && docker-compose --version"})]}),"\n",(0,c.jsxs)(s.li,{children:["Check logs: ",(0,c.jsx)(s.code,{children:"docker-compose logs"})]}),"\n",(0,c.jsxs)(s.li,{children:["Verify config: ",(0,c.jsx)(s.code,{children:"docker-compose config"})]}),"\n"]}),"\n",(0,c.jsx)(s.h3,{id:"Database-Connection-Errors",children:"Database Connection Errors"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["Verify PostgreSQL is running: ",(0,c.jsx)(s.code,{children:"docker-compose ps postgres"})]}),"\n",(0,c.jsxs)(s.li,{children:["Check health: ",(0,c.jsx)(s.code,{children:"docker-compose exec postgres pg_isready -U caracal"})]}),"\n",(0,c.jsxs)(s.li,{children:["Review credentials in ",(0,c.jsx)(s.code,{children:".env"})]}),"\n"]}),"\n",(0,c.jsx)(s.h3,{id:"TLS-Certificate-Errors",children:"TLS Certificate Errors"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["Verify certificates exist: ",(0,c.jsx)(s.code,{children:"ls -la certs/"})]}),"\n",(0,c.jsxs)(s.li,{children:["Check validity: ",(0,c.jsx)(s.code,{children:"openssl x509 -in certs/server.crt -text -noout"})]}),"\n"]}),"\n",(0,c.jsx)(s.h2,{id:"Production-Checklist",children:"Production Checklist"}),"\n",(0,c.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,c.jsxs)(s.li,{className:"task-list-item",children:[(0,c.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Change default database password"]}),"\n",(0,c.jsxs)(s.li,{className:"task-list-item",children:[(0,c.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Use production TLS certificates"]}),"\n",(0,c.jsxs)(s.li,{className:"task-list-item",children:[(0,c.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Configure firewall rules"]}),"\n",(0,c.jsxs)(s.li,{className:"task-list-item",children:[(0,c.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Enable mTLS authentication"]}),"\n",(0,c.jsxs)(s.li,{className:"task-list-item",children:[(0,c.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Set up log aggregation"]}),"\n",(0,c.jsxs)(s.li,{className:"task-list-item",children:[(0,c.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Configure backup strategy"]}),"\n",(0,c.jsxs)(s.li,{className:"task-list-item",children:[(0,c.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Review resource limits"]}),"\n",(0,c.jsxs)(s.li,{className:"task-list-item",children:[(0,c.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Set up alerting"]}),"\n"]}),"\n",(0,c.jsx)(s.h2,{id:"Next-Steps",children:"Next Steps"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.a,{href:"./kubernetes",children:"Kubernetes Deployment"})," - Deploy on Kubernetes"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.a,{href:"./production",children:"Production Guide"})," - Advanced production settings"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.a,{href:"./operationalRunbook",children:"Operational Runbook"})," - Operations procedures"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453(e,s,r){r.d(s,{R:()=>a,x:()=>i});var n=r(6540);const c={},t=n.createContext(c);function a(e){const s=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);