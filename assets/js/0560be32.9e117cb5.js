"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6916],{2756(e,n,a){a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"caracalCore/deployment/kubernetesAdvanced","title":"Kubernetes Advanced","description":"This guide covers advanced Kubernetes deployment configurations for Caracal Core.","source":"@site/docs/caracalCore/deployment/kubernetesAdvanced.md","sourceDirName":"caracalCore/deployment","slug":"/caracalCore/deployment/kubernetesAdvanced","permalink":"/caracalCore/deployment/kubernetesAdvanced","draft":false,"unlisted":false,"editUrl":"https://github.com/Garudex-Labs/Caracal/tree/main/docs/docs/caracalCore/deployment/kubernetesAdvanced.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Kubernetes Advanced"},"sidebar":"caracalSidebar","previous":{"title":"Kubernetes Deployment","permalink":"/caracalCore/deployment/kubernetes"},"next":{"title":"Production Guide","permalink":"/caracalCore/deployment/production"}}');var s=a(4848),c=a(8453);const t={sidebar_position:3,title:"Kubernetes Advanced"},l="Kubernetes Advanced Configuration",i={},o=[{value:"Architecture",id:"Architecture",level:2},{value:"Prerequisites",id:"Prerequisites",level:2},{value:"TLS Certificate Setup",id:"TLS-Certificate-Setup",level:2},{value:"Self-Signed (Development)",id:"Self-Signed-Development",level:3},{value:"Create Kubernetes Secret",id:"Create-Kubernetes-Secret",level:3},{value:"Resource Configuration",id:"Resource-Configuration",level:2},{value:"Gateway Proxy",id:"Gateway-Proxy",level:3},{value:"MCP Adapter",id:"MCP-Adapter",level:3},{value:"PostgreSQL",id:"PostgreSQL",level:3},{value:"Scaling",id:"Scaling",level:2},{value:"Monitoring",id:"Monitoring",level:2},{value:"Prometheus Metrics",id:"Prometheus-Metrics",level:3},{value:"Logs",id:"Logs",level:3},{value:"Database Management",id:"Database-Management",level:2},{value:"Initialize Schema",id:"Initialize-Schema",level:3},{value:"Backup and Restore",id:"Backup-and-Restore",level:3},{value:"Security",id:"Security",level:2},{value:"Network Policies",id:"Network-Policies",level:3},{value:"Pod Security",id:"Pod-Security",level:3},{value:"Troubleshooting",id:"Troubleshooting",level:2},{value:"Pods Not Starting",id:"Pods-Not-Starting",level:3},{value:"Database Connection Issues",id:"Database-Connection-Issues",level:3},{value:"LoadBalancer Not Getting IP",id:"LoadBalancer-Not-Getting-IP",level:3},{value:"Cleanup",id:"Cleanup",level:2},{value:"Production Considerations",id:"Production-Considerations",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"Kubernetes-Advanced-Configuration",children:"Kubernetes Advanced Configuration"})}),"\n",(0,s.jsx)(n.p,{children:"This guide covers advanced Kubernetes deployment configurations for Caracal Core."}),"\n",(0,s.jsx)(n.h2,{id:"Architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.p,{children:"The deployment consists of:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PostgreSQL StatefulSet"}),": Persistent database with 10Gi storage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Gateway Proxy Deployment"}),": 3 replicas with LoadBalancer service"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"MCP Adapter Deployment"}),": 2 replicas with ClusterIP service"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ConfigMap"}),": Non-sensitive configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Secrets"}),": Database credentials and TLS certificates"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"Prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Kubernetes Cluster (v1.20+)"}),"\n",(0,s.jsx)(n.li,{children:"kubectl configured to access your cluster"}),"\n",(0,s.jsx)(n.li,{children:"TLS Certificates for Gateway Proxy HTTPS and mTLS"}),"\n",(0,s.jsx)(n.li,{children:"Storage Class for PostgreSQL persistent volumes"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"TLS-Certificate-Setup",children:"TLS Certificate Setup"}),"\n",(0,s.jsx)(n.h3,{id:"Self-Signed-Development",children:"Self-Signed (Development)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'mkdir -p certs\n\n# Server certificate\nopenssl req -x509 -newkey rsa:4096 -keyout certs/server.key -out certs/server.crt \\\n  -days 365 -nodes -subj "/CN=caracal-gateway"\n\n# CA certificate for mTLS\nopenssl req -x509 -newkey rsa:4096 -keyout certs/ca.key -out certs/ca.crt \\\n  -days 365 -nodes -subj "/CN=caracal-ca"\n\n# JWT keys\nssh-keygen -t rsa -b 4096 -m PEM -f certs/jwt_private.pem -N ""\nopenssl rsa -in certs/jwt_private.pem -pubout -out certs/jwt_public.pem\n'})}),"\n",(0,s.jsx)(n.h3,{id:"Create-Kubernetes-Secret",children:"Create Kubernetes Secret"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl create secret generic caracal-tls \\\n  --from-file=server.crt=certs/server.crt \\\n  --from-file=server.key=certs/server.key \\\n  --from-file=ca.crt=certs/ca.crt \\\n  --from-file=jwt_public.pem=certs/jwt_public.pem \\\n  --namespace=caracal\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Resource-Configuration",children:"Resource Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"Gateway-Proxy",children:"Gateway Proxy"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"resources:\n  requests:\n    cpu: 250m\n    memory: 256Mi\n  limits:\n    cpu: 2000m\n    memory: 1Gi\n"})}),"\n",(0,s.jsx)(n.h3,{id:"MCP-Adapter",children:"MCP Adapter"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"resources:\n  requests:\n    cpu: 250m\n    memory: 256Mi\n  limits:\n    cpu: 2000m\n    memory: 1Gi\n"})}),"\n",(0,s.jsx)(n.h3,{id:"PostgreSQL",children:"PostgreSQL"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"resources:\n  requests:\n    cpu: 500m\n    memory: 512Mi\n  limits:\n    cpu: 2000m\n    memory: 2Gi\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Scaling",children:"Scaling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Scale Gateway to 5 replicas\nkubectl scale deployment caracal-gateway -n caracal --replicas=5\n\n# Scale MCP Adapter to 3 replicas\nkubectl scale deployment caracal-mcp-adapter -n caracal --replicas=3\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Monitoring",children:"Monitoring"}),"\n",(0,s.jsx)(n.h3,{id:"Prometheus-Metrics",children:"Prometheus Metrics"}),"\n",(0,s.jsx)(n.p,{children:"Pods are annotated for automatic Prometheus scraping:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'annotations:\n  prometheus.io/scrape: "true"\n  prometheus.io/port: "9090"\n  prometheus.io/path: "/metrics"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"Logs",children:"Logs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl logs -n caracal -l app.kubernetes.io/component=gateway -f\nkubectl logs -n caracal -l app.kubernetes.io/component=mcp-adapter -f\nkubectl logs -n caracal -l app.kubernetes.io/component=database -f\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Database-Management",children:"Database Management"}),"\n",(0,s.jsx)(n.h3,{id:"Initialize-Schema",children:"Initialize Schema"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward -n caracal svc/caracal-postgres 5432:5432 &\n\nexport DB_HOST=localhost\nexport DB_PORT=5432\nexport DB_NAME=caracal\nexport DB_USER=caracal\nexport DB_PASSWORD=<your-password>\n\ncaracal db init\ncaracal db migrate up\n"})}),"\n",(0,s.jsx)(n.h3,{id:"Backup-and-Restore",children:"Backup and Restore"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Backup\nkubectl exec -n caracal caracal-postgres-0 -- \\\n  pg_dump -U caracal caracal > caracal-backup.sql\n\n# Restore\nkubectl exec -i -n caracal caracal-postgres-0 -- \\\n  psql -U caracal caracal < caracal-backup.sql\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Security",children:"Security"}),"\n",(0,s.jsx)(n.h3,{id:"Network-Policies",children:"Network Policies"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: caracal-network-policy\n  namespace: caracal\nspec:\n  podSelector:\n    matchLabels:\n      app.kubernetes.io/name: caracal\n  policyTypes:\n    - Ingress\n    - Egress\n  ingress:\n    - from:\n        - namespaceSelector:\n            matchLabels:\n              name: caracal\n  egress:\n    - to:\n        - namespaceSelector:\n            matchLabels:\n              name: caracal\n"})}),"\n",(0,s.jsx)(n.h3,{id:"Pod-Security",children:"Pod Security"}),"\n",(0,s.jsx)(n.p,{children:"Pods are configured with security best practices:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Run as non-root user (UID 1000)"}),"\n",(0,s.jsx)(n.li,{children:"Drop all capabilities"}),"\n",(0,s.jsx)(n.li,{children:"No privilege escalation"}),"\n",(0,s.jsx)(n.li,{children:"Read-only root filesystem (where possible)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"Troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"Pods-Not-Starting",children:"Pods Not Starting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n caracal\nkubectl describe pod <pod-name> -n caracal\nkubectl logs <pod-name> -n caracal\n"})}),"\n",(0,s.jsx)(n.h3,{id:"Database-Connection-Issues",children:"Database Connection Issues"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl exec -n caracal caracal-postgres-0 -- pg_isready -U caracal\nkubectl logs -n caracal caracal-postgres-0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"LoadBalancer-Not-Getting-IP",children:"LoadBalancer Not Getting IP"}),"\n",(0,s.jsx)(n.p,{children:"Use NodePort instead:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spec:\n  type: NodePort\n  ports:\n    - name: https\n      port: 8443\n      targetPort: 8443\n      nodePort: 30443\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Cleanup",children:"Cleanup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl delete namespace caracal\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Warning"}),": This deletes all data including the database."]}),"\n",(0,s.jsx)(n.h2,{id:"Production-Considerations",children:"Production Considerations"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"High Availability"}),": Use PostgreSQL replication, deploy across multiple AZs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Backup"}),": Implement automated database backups"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitoring"}),": Set up Prometheus and Grafana"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security"}),": Use production TLS certificates, implement network policies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Performance"}),": Tune connection pools, use horizontal pod autoscaling"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,a){a.d(n,{R:()=>t,x:()=>l});var r=a(6540);const s={},c=r.createContext(s);function t(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);