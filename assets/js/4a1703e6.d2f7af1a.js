"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[740],{7991(e,n,s){s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"development/versionManagement","title":"Version Management in Caracal Core","description":"Overview","source":"@site/docs/development/versionManagement.md","sourceDirName":"development","slug":"/development/versionManagement","permalink":"/development/versionManagement","draft":false,"unlisted":false,"editUrl":"https://github.com/Garudex-Labs/Caracal/tree/main/docs/docs/development/versionManagement.md","tags":[],"version":"current","frontMatter":{},"sidebar":"caracalSidebar","previous":{"title":"Contributing","permalink":"/development/contributing"},"next":{"title":"Getting Started with Caracal Enterprise","permalink":"/caracalEnterprise/gettingStarted/"}}');var i=s(4848),l=s(8453);const a={},c="Version Management in Caracal Core",t={},d=[{value:"Overview",id:"Overview",level:2},{value:"Architecture",id:"Architecture",level:2},{value:"Single Source of Truth",id:"Single-Source-of-Truth",level:3},{value:"How It Works",id:"How-It-Works",level:3},{value:"Python Package",id:"Python-Package",level:4},{value:"Docker Images",id:"Docker-Images",level:4},{value:"Helm Charts",id:"Helm-Charts",level:4},{value:"Kubernetes Manifests",id:"Kubernetes-Manifests",level:4},{value:"Usage",id:"Usage",level:2},{value:"Updating the Version",id:"Updating-the-Version",level:3},{value:"Automated Release",id:"Automated-Release",level:3},{value:"Manual Release Steps",id:"Manual-Release-Steps",level:3},{value:"Version Format",id:"Version-Format",level:2},{value:"Version Prefixes",id:"Version-Prefixes",level:3},{value:"Files Updated by Scripts",id:"Files-Updated-by-Scripts",level:2},{value:"update-version.sh",id:"update-versionsh",level:3},{value:"build-images.sh",id:"build-imagessh",level:3},{value:"release.sh",id:"releasesh",level:3},{value:"Accessing Version at Runtime",id:"Accessing-Version-at-Runtime",level:2},{value:"Python Code",id:"Python-Code",level:3},{value:"CLI",id:"CLI",level:3},{value:"Docker Container",id:"Docker-Container",level:3},{value:"Kubernetes",id:"Kubernetes",level:3},{value:"Best Practices",id:"Best-Practices",level:2},{value:"Troubleshooting",id:"Troubleshooting",level:2},{value:"Version Mismatch",id:"Version-Mismatch",level:3},{value:"Python Package Version",id:"Python-Package-Version",level:3},{value:"Docker Image Version",id:"Docker-Image-Version",level:3},{value:"Migration from Hardcoded Versions",id:"Migration-from-Hardcoded-Versions",level:2},{value:"References",id:"References",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"Version-Management-in-Caracal-Core",children:"Version Management in Caracal Core"})}),"\n",(0,i.jsx)(n.h2,{id:"Overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Caracal Core uses a centralized version management system where the ",(0,i.jsx)(n.code,{children:"VERSION"})," file at the root of the project serves as the single source of truth for all version references."]}),"\n",(0,i.jsx)(n.h2,{id:"Architecture",children:"Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"Single-Source-of-Truth",children:"Single Source of Truth"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"VERSION"})," file contains only the version number (e.g., ",(0,i.jsx)(n.code,{children:"1.0.0"}),") and is used by:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Python Package"})," (",(0,i.jsx)(n.code,{children:"pyproject.toml"}),", ",(0,i.jsx)(n.code,{children:"setup.py"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Runtime Code"})," (",(0,i.jsx)(n.code,{children:"caracal/_version.py"}),", ",(0,i.jsx)(n.code,{children:"caracal/__init__.py"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Docker Images"})," (via build scripts)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Helm Charts"})," (",(0,i.jsx)(n.code,{children:"helm/caracal/Chart.yaml"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Kubernetes Manifests"})," (all ",(0,i.jsx)(n.code,{children:"*.yaml"})," files in ",(0,i.jsx)(n.code,{children:"k8s/"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"How-It-Works",children:"How It Works"}),"\n",(0,i.jsx)(n.h4,{id:"Python-Package",children:"Python Package"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"pyproject.toml:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[project]\nname = "caracal-core"\ndynamic = ["version"]\n\n[tool.setuptools.dynamic]\nversion = {file = ["VERSION"]}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"setup.py:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pathlib import Path\nfrom setuptools import setup\n\nversion_file = Path(__file__).parent / "VERSION"\nversion = version_file.read_text().strip()\n\nsetup(version=version)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"caracal/_version.py:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pathlib import Path\n\ndef get_version() -> str:\n    version_file = Path(__file__).parent.parent / "VERSION"\n    if version_file.exists():\n        return version_file.read_text().strip()\n    return "unknown"\n\n__version__ = get_version()\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["caracal/",(0,i.jsx)(n.strong,{children:"init"}),".py:"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from caracal._version import __version__\n\n__all__ = ["__version__"]\n'})}),"\n",(0,i.jsx)(n.h4,{id:"Docker-Images",children:"Docker Images"}),"\n",(0,i.jsx)(n.p,{children:"Docker images are built with version tags read from the VERSION file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"VERSION=$(cat VERSION | tr -d '[:space:]')\ndocker build -t caracal-gateway:v$VERSION -f Dockerfile.gateway .\n"})}),"\n",(0,i.jsx)(n.h4,{id:"Helm-Charts",children:"Helm Charts"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"update-version.sh"})," script updates Helm Chart.yaml:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'VERSION=$(cat VERSION | tr -d \'[:space:]\')\nsed -i "s/^version: .*/version: $VERSION/" helm/caracal/Chart.yaml\nsed -i "s/^appVersion: .*/appVersion: \\"$VERSION\\"/" helm/caracal/Chart.yaml\n'})}),"\n",(0,i.jsx)(n.h4,{id:"Kubernetes-Manifests",children:"Kubernetes Manifests"}),"\n",(0,i.jsx)(n.p,{children:"All Kubernetes manifests use version labels that are updated by the script:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'metadata:\n  labels:\n    app.kubernetes.io/version: "1.0.0"  # Updated by script\n'})}),"\n",(0,i.jsx)(n.h2,{id:"Usage",children:"Usage"}),"\n",(0,i.jsx)(n.h3,{id:"Updating-the-Version",children:"Updating the Version"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Edit VERSION file:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'echo "1.0.0" > VERSION\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Update all references:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./scripts/update-version.sh\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Verify changes:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git diff\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Commit changes:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'git add VERSION pyproject.toml helm/ k8s/\ngit commit -m "Bump version to 1.0.0"\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"Automated-Release",children:"Automated Release"}),"\n",(0,i.jsx)(n.p,{children:"Use the release script for a complete release process:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./scripts/release.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"This will:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Update all version references"}),"\n",(0,i.jsx)(n.li,{children:"Create git tag (optional)"}),"\n",(0,i.jsx)(n.li,{children:"Build Docker images (optional)"}),"\n",(0,i.jsx)(n.li,{children:"Package Helm chart (optional)"}),"\n",(0,i.jsx)(n.li,{children:"Publish to PyPI (optional)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"Manual-Release-Steps",children:"Manual Release Steps"}),"\n",(0,i.jsx)(n.p,{children:"If you prefer manual control:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# 1. Update version\necho "1.0.0" > VERSION\n\n# 2. Update references\n./scripts/update-version.sh\n\n# 3. Commit changes\ngit add VERSION pyproject.toml helm/ k8s/\ngit commit -m "Bump version to 1.0.0"\n\n# 4. Create tag\ngit tag -a v1.0.0 -m "Release v1.0.0"\ngit push origin main\ngit push origin v1.0.0\n\n# 5. Build Docker images\n./scripts/build-images.sh\n\n# 6. Package Helm chart\ncd helm\nhelm package caracal\nhelm push caracal-1.0.0.tgz oci://registry.example.com/charts\n\n# 7. Publish to PyPI\ncd ..\npython -m build\ntwine upload dist/*\n'})}),"\n",(0,i.jsx)(n.h2,{id:"Version-Format",children:"Version Format"}),"\n",(0,i.jsxs)(n.p,{children:["Caracal Core follows ",(0,i.jsx)(n.a,{href:"https://semver.org/",children:"Semantic Versioning"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"MAJOR.MINOR.PATCH"})," (e.g., ",(0,i.jsx)(n.code,{children:"1.0.0"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"MAJOR"}),": Breaking changes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"MINOR"}),": New features (backward compatible)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PATCH"}),": Bug fixes (backward compatible)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"Version-Prefixes",children:"Version Prefixes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Git tags"}),": Use ",(0,i.jsx)(n.code,{children:"v"})," prefix (e.g., ",(0,i.jsx)(n.code,{children:"v1.0.0"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Docker images"}),": Use ",(0,i.jsx)(n.code,{children:"v"})," prefix (e.g., ",(0,i.jsx)(n.code,{children:"caracal-gateway:v1.0.0"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Helm charts"}),": No ",(0,i.jsx)(n.code,{children:"v"})," prefix (e.g., ",(0,i.jsx)(n.code,{children:"version: 1.0.0"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Python package"}),": No ",(0,i.jsx)(n.code,{children:"v"})," prefix (e.g., ",(0,i.jsx)(n.code,{children:'version = "1.0.0"'}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Kubernetes labels"}),": No ",(0,i.jsx)(n.code,{children:"v"})," prefix (e.g., ",(0,i.jsx)(n.code,{children:'app.kubernetes.io/version: "1.0.0"'}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"Files-Updated-by-Scripts",children:"Files Updated by Scripts"}),"\n",(0,i.jsx)(n.h3,{id:"update-versionsh",children:"update-version.sh"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"helm/caracal/Chart.yaml"})," (version and appVersion)"]}),"\n",(0,i.jsxs)(n.li,{children:["All ",(0,i.jsx)(n.code,{children:"k8s/**/*.yaml"})," files (app.kubernetes.io/version labels)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"build-imagessh",children:"build-images.sh"}),"\n",(0,i.jsx)(n.p,{children:"Builds Docker images with version tags:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"caracal-gateway:v{VERSION}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"caracal-mcp-adapter:v{VERSION}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"caracal-consumer:v{VERSION}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"caracal-cli:v{VERSION}"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"releasesh",children:"release.sh"}),"\n",(0,i.jsx)(n.p,{children:"Orchestrates the entire release process by calling other scripts and performing git operations."}),"\n",(0,i.jsx)(n.h2,{id:"Accessing-Version-at-Runtime",children:"Accessing Version at Runtime"}),"\n",(0,i.jsx)(n.h3,{id:"Python-Code",children:"Python Code"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import caracal\nprint(caracal.__version__)  # e.g., "1.0.0"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"CLI",children:"CLI"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"caracal --version\n"})}),"\n",(0,i.jsx)(n.h3,{id:"Docker-Container",children:"Docker Container"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run caracal-gateway:v1.0.0 caracal --version\n"})}),"\n",(0,i.jsx)(n.h3,{id:"Kubernetes",children:"Kubernetes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get deployment caracal-gateway -o jsonpath='{.metadata.labels.app\\.kubernetes\\.io/version}'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"Best-Practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Always update VERSION file first"})," before running scripts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Run update-version.sh"})," after changing VERSION file"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Commit VERSION file changes"})," with all updated references"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use semantic versioning"})," for version numbers"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Tag releases"})," with ",(0,i.jsx)(n.code,{children:"v"})," prefix (e.g., ",(0,i.jsx)(n.code,{children:"v1.0.0"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test locally"})," before pushing tags"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document changes"})," in RELEASE_NOTES.md"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"Troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"Version-Mismatch",children:"Version Mismatch"}),"\n",(0,i.jsx)(n.p,{children:"If you see version mismatches:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Re-run update script\n./scripts/update-version.sh\n\n# Verify all files are updated\ngit diff\n"})}),"\n",(0,i.jsx)(n.h3,{id:"Python-Package-Version",children:"Python Package Version"}),"\n",(0,i.jsx)(n.p,{children:"If Python package shows wrong version:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Rebuild package\npython -m build\n\n# Check version\npython -c "import caracal; print(caracal.__version__)"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"Docker-Image-Version",children:"Docker Image Version"}),"\n",(0,i.jsx)(n.p,{children:"If Docker images have wrong tags:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Rebuild images\n./scripts/build-images.sh\n\n# Verify tags\ndocker images | grep caracal\n"})}),"\n",(0,i.jsx)(n.h2,{id:"Migration-from-Hardcoded-Versions",children:"Migration from Hardcoded Versions"}),"\n",(0,i.jsx)(n.p,{children:"If you're migrating from hardcoded versions:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create VERSION file with current version"}),"\n",(0,i.jsx)(n.li,{children:"Update pyproject.toml to use dynamic versioning"}),"\n",(0,i.jsx)(n.li,{children:"Update setup.py to read from VERSION file"}),"\n",(0,i.jsx)(n.li,{children:"Create _version.py module"}),"\n",(0,i.jsxs)(n.li,{children:["Update ",(0,i.jsx)(n.strong,{children:"init"}),".py to import from _version.py"]}),"\n",(0,i.jsx)(n.li,{children:"Run update-version.sh to update all references"}),"\n",(0,i.jsx)(n.li,{children:"Test that version is correctly read everywhere"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"References",children:"References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://semver.org/",children:"Semantic Versioning"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.python.org/dev/peps/pep-0440/",children:"PEP 440 - Version Identification"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html#dynamic-metadata",children:"setuptools Dynamic Metadata"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>c});var r=s(6540);const i={},l=r.createContext(i);function a(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);