"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3306],{1098(e,r,n){n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"caracalCore/apiReference/mcpDecorators","title":"MCP Adapter Decorator -- SDK Plugin Mode","description":"Overview","source":"@site/docs/caracalCore/apiReference/mcpDecorators.md","sourceDirName":"caracalCore/apiReference","slug":"/caracalCore/apiReference/mcpDecorators","permalink":"/caracalCore/apiReference/mcpDecorators","draft":false,"unlisted":false,"editUrl":"https://github.com/Garudex-Labs/Caracal/tree/main/docs/docs/caracalCore/apiReference/mcpDecorators.md","tags":[],"version":"current","frontMatter":{},"sidebar":"caracalSidebar","previous":{"title":"MCP Adapter for Caracal Core","permalink":"/caracalCore/apiReference/mcpIntegration"},"next":{"title":"Docker Compose Deployment","permalink":"/caracalCore/deployment/dockerCompose"}}');var t=n(4848),a=n(8453);const o={},s="MCP Adapter Decorator -- SDK Plugin Mode",l={},c=[{value:"Overview",id:"Overview",level:2},{value:"Features",id:"Features",level:2},{value:"Usage",id:"Usage",level:2},{value:"Basic Usage",id:"Basic-Usage",level:3},{value:"Principal ID Parameter",id:"Principal-ID-Parameter",level:3},{value:"How It Works",id:"How-It-Works",level:2},{value:"Error Handling",id:"Error-Handling",level:2},{value:"Authority Denied",id:"Authority-Denied",level:3},{value:"Missing Principal ID",id:"Missing-Principal-ID",level:3},{value:"Examples",id:"Examples",level:2},{value:"LLM Tool",id:"LLM-Tool",level:3},{value:"Database Query Tool",id:"Database-Query-Tool",level:3},{value:"Comparison with Service Mode",id:"Comparison-with-Service-Mode",level:2},{value:"Best Practices",id:"Best-Practices",level:2},{value:"See Also",id:"See-Also",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"MCP-Adapter-Decorator----SDK-Plugin-Mode",children:"MCP Adapter Decorator -- SDK Plugin Mode"})}),"\n",(0,t.jsx)(r.h2,{id:"Overview",children:"Overview"}),"\n",(0,t.jsx)(r.p,{children:"The MCP Adapter decorator provides a simple way to add Caracal authority enforcement to MCP tool functions in SDK plugin mode. This allows developers to integrate Caracal directly into their Python applications without deploying a separate service."}),"\n",(0,t.jsx)(r.h2,{id:"Features",children:"Features"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Automatic mandate validation before tool execution"}),"\n",(0,t.jsx)(r.li,{children:"Automatic authority event recording after execution"}),"\n",(0,t.jsx)(r.li,{children:"Support for both async and sync functions"}),"\n",(0,t.jsx)(r.li,{children:"Flexible principal_id parameter handling"}),"\n",(0,t.jsx)(r.li,{children:"Fail-closed error handling"}),"\n",(0,t.jsx)(r.li,{children:"Preserves function metadata (name, docstring)"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"Usage",children:"Usage"}),"\n",(0,t.jsx)(r.h3,{id:"Basic-Usage",children:"Basic Usage"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'from caracal.mcp.adapter import MCPAdapter\nfrom caracal.core.authority import AuthorityEnforcer\nfrom caracal.core.ledger import LedgerWriter\n\n# Initialize Caracal components\nauthority_enforcer = AuthorityEnforcer(...)\nledger_writer = LedgerWriter(...)\n\n# Create MCP adapter\nmcp_adapter = MCPAdapter(\n    authority_enforcer=authority_enforcer,\n    ledger_writer=ledger_writer\n)\n\n# Decorate your MCP tool function\n@mcp_adapter.as_decorator()\nasync def my_mcp_tool(principal_id: str, param1: str, param2: int):\n    """Your MCP tool implementation."""\n    return {"result": f"{param1}_{param2}"}\n\n# Use the decorated tool\nresult = await my_mcp_tool(\n    principal_id="principal-123",\n    param1="test",\n    param2=42\n)\n'})}),"\n",(0,t.jsx)(r.h3,{id:"Principal-ID-Parameter",children:"Principal ID Parameter"}),"\n",(0,t.jsxs)(r.p,{children:["The decorator requires a ",(0,t.jsx)(r.code,{children:"principal_id"})," parameter to identify which principal is making the request:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'# As a keyword argument (recommended)\nresult = await my_tool(principal_id="principal-123", param1="test")\n\n# As the first positional argument\nresult = await my_tool("principal-123", param1="test")\n'})}),"\n",(0,t.jsx)(r.p,{children:"The decorator recognizes these parameter names:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"principal_id"})," (preferred)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"agent_id"})," (backward compatibility)"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"How-It-Works",children:"How It Works"}),"\n",(0,t.jsx)(r.p,{children:"When you call a decorated function, the decorator:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Extracts principal_id"})," from the function arguments"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Validates mandate"})," via AuthorityEnforcer for the requested resource"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Executes the tool"})," if authority check passes"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Records authority event"})," in the ledger"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Returns the result"})," to the caller"]}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["If the authority check fails, an ",(0,t.jsx)(r.code,{children:"AuthorityDeniedError"})," is raised before the tool executes."]}),"\n",(0,t.jsx)(r.h2,{id:"Error-Handling",children:"Error Handling"}),"\n",(0,t.jsx)(r.h3,{id:"Authority-Denied",children:"Authority Denied"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'from caracal.exceptions import AuthorityDeniedError\n\ntry:\n    result = await my_tool(principal_id="principal-123", param1="test")\nexcept AuthorityDeniedError as e:\n    print(f"Authority denied: {e}")\n'})}),"\n",(0,t.jsx)(r.h3,{id:"Missing-Principal-ID",children:"Missing Principal ID"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'from caracal.exceptions import CaracalError\n\ntry:\n    result = await my_tool(param1="test")  # Missing principal_id\nexcept CaracalError as e:\n    print(f"Error: {e}")\n'})}),"\n",(0,t.jsx)(r.h2,{id:"Examples",children:"Examples"}),"\n",(0,t.jsx)(r.h3,{id:"LLM-Tool",children:"LLM Tool"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'@mcp_adapter.as_decorator()\nasync def llm_completion(principal_id: str, prompt: str, model: str = "gpt-4"):\n    """Generate LLM completion."""\n    response = await llm_api.complete(prompt=prompt, model=model)\n    return {"completion": response.text, "model": model}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"Database-Query-Tool",children:"Database Query Tool"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'@mcp_adapter.as_decorator()\nasync def query_database(principal_id: str, sql: str, database: str = "main"):\n    """Execute a database query."""\n    async with db_pool.acquire() as conn:\n        rows = await conn.fetch(sql)\n    return {"rows": [dict(row) for row in rows], "count": len(rows)}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"Comparison-with-Service-Mode",children:"Comparison with Service Mode"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Feature"}),(0,t.jsx)(r.th,{children:"Decorator (SDK Plugin)"}),(0,t.jsx)(r.th,{children:"Standalone Service"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Deployment"}),(0,t.jsx)(r.td,{children:"In-process"}),(0,t.jsx)(r.td,{children:"Separate container"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Network overhead"}),(0,t.jsx)(r.td,{children:"None"}),(0,t.jsx)(r.td,{children:"HTTP/gRPC calls"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Language support"}),(0,t.jsx)(r.td,{children:"Python only"}),(0,t.jsx)(r.td,{children:"Any language"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Integration effort"}),(0,t.jsx)(r.td,{children:"Low (just add decorator)"}),(0,t.jsx)(r.td,{children:"Medium (configure proxy)"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Scalability"}),(0,t.jsx)(r.td,{children:"Scales with app"}),(0,t.jsx)(r.td,{children:"Independent scaling"})]})]})]}),"\n",(0,t.jsx)(r.h2,{id:"Best-Practices",children:"Best Practices"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Always provide principal_id"}),": Required for authority enforcement"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Use descriptive tool names"}),": Function names become resource identifiers in authority events"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Handle authority errors"}),": Catch ",(0,t.jsx)(r.code,{children:"AuthorityDeniedError"})," and provide user feedback"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Test with mocked components"}),": Use mocks for AuthorityEnforcer and LedgerWriter in tests"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"See-Also",children:"See Also"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"./mcpIntegration",children:"MCP Adapter Service Mode"})," -- Standalone service deployment"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"./sdkClient",children:"SDK Client"})," -- Authority enforcement SDK"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,r,n){n.d(r,{R:()=>o,x:()=>s});var i=n(6540);const t={},a=i.createContext(t);function o(e){const r=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(a.Provider,{value:r},e.children)}}}]);