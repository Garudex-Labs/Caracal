"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3692],{9009(e,a,n){n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"caracalCore/deployment/kubernetes","title":"Kubernetes Deployment","description":"This guide covers deploying Caracal Core to a Kubernetes cluster.","source":"@site/docs/caracalCore/deployment/kubernetes.md","sourceDirName":"caracalCore/deployment","slug":"/caracalCore/deployment/kubernetes","permalink":"/caracalCore/deployment/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/Garudex-Labs/Caracal/tree/main/docs/docs/caracalCore/deployment/kubernetes.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Kubernetes Deployment"},"sidebar":"caracalSidebar","previous":{"title":"Docker Compose Deployment","permalink":"/caracalCore/deployment/dockerCompose"},"next":{"title":"Kubernetes Advanced","permalink":"/caracalCore/deployment/kubernetesAdvanced"}}');var l=n(4848),t=n(8453);const r={sidebar_position:2,title:"Kubernetes Deployment"},c="Kubernetes Deployment",i={},o=[{value:"Prerequisites",id:"Prerequisites",level:2},{value:"Quick Deploy (Automated)",id:"Quick-Deploy-Automated",level:2},{value:"Manual Deploy",id:"Manual-Deploy",level:2},{value:"1. Create TLS Certificates",id:"1-Create-TLS-Certificates",level:3},{value:"2. Deploy to Kubernetes",id:"2-Deploy-to-Kubernetes",level:3},{value:"3. Verify Deployment",id:"3-Verify-Deployment",level:3},{value:"Initialize Database",id:"Initialize-Database",level:2},{value:"Access the Gateway",id:"Access-the-Gateway",level:2},{value:"Configuration",id:"Configuration",level:2},{value:"Update Database Password",id:"Update-Database-Password",level:3},{value:"Configure MCP Servers",id:"Configure-MCP-Servers",level:3},{value:"Adjust Replicas",id:"Adjust-Replicas",level:3},{value:"Optional Components",id:"Optional-Components",level:2},{value:"Enable Autoscaling",id:"Enable-Autoscaling",level:3},{value:"Enable Ingress",id:"Enable-Ingress",level:3},{value:"Enable Pod Disruption Budgets",id:"Enable-Pod-Disruption-Budgets",level:3},{value:"Enable Prometheus Monitoring",id:"Enable-Prometheus-Monitoring",level:3},{value:"Troubleshooting",id:"Troubleshooting",level:2},{value:"Pods Not Starting",id:"Pods-Not-Starting",level:3},{value:"Database Connection Issues",id:"Database-Connection-Issues",level:3},{value:"LoadBalancer Not Getting IP",id:"LoadBalancer-Not-Getting-IP",level:3},{value:"Cleanup",id:"Cleanup",level:2},{value:"Production Checklist",id:"Production-Checklist",level:2},{value:"Next Steps",id:"Next-Steps",level:2}];function d(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.header,{children:(0,l.jsx)(a.h1,{id:"Kubernetes-Deployment",children:"Kubernetes Deployment"})}),"\n",(0,l.jsx)(a.p,{children:"This guide covers deploying Caracal Core to a Kubernetes cluster."}),"\n",(0,l.jsx)(a.h2,{id:"Prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsx)(a.li,{children:"Kubernetes cluster (v1.20+)"}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.code,{children:"kubectl"})," configured to access your cluster"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.code,{children:"openssl"})," for generating TLS certificates"]}),"\n"]}),"\n",(0,l.jsx)(a.h2,{id:"Quick-Deploy-Automated",children:"Quick Deploy (Automated)"}),"\n",(0,l.jsx)(a.p,{children:"The fastest way to deploy:"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"cd k8s\n./deploy.sh --wait\n"})}),"\n",(0,l.jsx)(a.p,{children:"This script will:"}),"\n",(0,l.jsxs)(a.ol,{children:["\n",(0,l.jsxs)(a.li,{children:["Create the ",(0,l.jsx)(a.code,{children:"caracal"})," namespace"]}),"\n",(0,l.jsx)(a.li,{children:"Generate self-signed TLS certificates (for testing)"}),"\n",(0,l.jsx)(a.li,{children:"Deploy PostgreSQL with persistent storage"}),"\n",(0,l.jsx)(a.li,{children:"Deploy Gateway Proxy (3 replicas)"}),"\n",(0,l.jsx)(a.li,{children:"Deploy MCP Adapter (2 replicas)"}),"\n",(0,l.jsx)(a.li,{children:"Wait for all components to be ready"}),"\n"]}),"\n",(0,l.jsx)(a.h2,{id:"Manual-Deploy",children:"Manual Deploy"}),"\n",(0,l.jsx)(a.h3,{id:"1-Create-TLS-Certificates",children:"1. Create TLS Certificates"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:'mkdir -p k8s/certs\ncd k8s/certs\n\n# Server certificate for Gateway HTTPS\nopenssl req -x509 -newkey rsa:4096 -keyout server.key -out server.crt \\\n  -days 365 -nodes -subj "/CN=caracal-gateway"\n\n# CA certificate for mTLS\nopenssl req -x509 -newkey rsa:4096 -keyout ca.key -out ca.crt \\\n  -days 365 -nodes -subj "/CN=caracal-ca"\n\n# JWT keys\nssh-keygen -t rsa -b 4096 -m PEM -f jwt_private.pem -N ""\nopenssl rsa -in jwt_private.pem -pubout -out jwt_public.pem\n\ncd ..\n'})}),"\n",(0,l.jsx)(a.h3,{id:"2-Deploy-to-Kubernetes",children:"2. Deploy to Kubernetes"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Create namespace\nkubectl apply -f namespace.yaml\n\n# Create ConfigMap and Secrets\nkubectl apply -f configmap.yaml\nkubectl apply -f secret.yaml\n\n# Create TLS secret from files\nkubectl create secret generic caracal-tls \\\n  --from-file=server.crt=certs/server.crt \\\n  --from-file=server.key=certs/server.key \\\n  --from-file=ca.crt=certs/ca.crt \\\n  --from-file=jwt_public.pem=certs/jwt_public.pem \\\n  --namespace=caracal\n\n# Deploy PostgreSQL\nkubectl apply -f postgres-statefulset.yaml\n\n# Wait for PostgreSQL\nkubectl wait --for=condition=ready pod -l app.kubernetes.io/component=database \\\n  -n caracal --timeout=300s\n\n# Deploy Gateway Proxy\nkubectl apply -f gateway-deployment.yaml\n\n# Deploy MCP Adapter\nkubectl apply -f mcp-adapter-deployment.yaml\n"})}),"\n",(0,l.jsx)(a.h3,{id:"3-Verify-Deployment",children:"3. Verify Deployment"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl get pods -n caracal\nkubectl get svc -n caracal\nkubectl logs -n caracal -l app.kubernetes.io/component=gateway --tail=50\n"})}),"\n",(0,l.jsx)(a.h2,{id:"Initialize-Database",children:"Initialize Database"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Port-forward to PostgreSQL\nkubectl port-forward -n caracal svc/caracal-postgres 5432:5432 &\n\n# Set environment variables\nexport DB_HOST=localhost\nexport DB_PORT=5432\nexport DB_NAME=caracal\nexport DB_USER=caracal\nexport DB_PASSWORD=<your-password>\n\n# Initialize database\ncaracal db init\ncaracal db migrate up\n"})}),"\n",(0,l.jsx)(a.h2,{id:"Access-the-Gateway",children:"Access the Gateway"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl get svc caracal-gateway -n caracal\n\nGATEWAY_IP=$(kubectl get svc caracal-gateway -n caracal -o jsonpath='{.status.loadBalancer.ingress[0].ip}')\ncurl -k https://$GATEWAY_IP:8443/health\n"})}),"\n",(0,l.jsx)(a.h2,{id:"Configuration",children:"Configuration"}),"\n",(0,l.jsx)(a.h3,{id:"Update-Database-Password",children:"Update Database Password"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:'NEW_PASSWORD=$(openssl rand -base64 32)\necho -n "$NEW_PASSWORD" | base64\n\n# Update secret.yaml with the base64 value, then:\nkubectl apply -f secret.yaml\nkubectl rollout restart deployment -n caracal\n'})}),"\n",(0,l.jsx)(a.h3,{id:"Configure-MCP-Servers",children:"Configure MCP Servers"}),"\n",(0,l.jsxs)(a.p,{children:["Edit ",(0,l.jsx)(a.code,{children:"configmap.yaml"}),":"]}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",children:'data:\n  MCP_SERVERS: "local:http://mcp-server:3000,remote:http://external-mcp:3001"\n'})}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f configmap.yaml\nkubectl rollout restart deployment caracal-mcp-adapter -n caracal\n"})}),"\n",(0,l.jsx)(a.h3,{id:"Adjust-Replicas",children:"Adjust Replicas"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl scale deployment caracal-gateway -n caracal --replicas=5\nkubectl scale deployment caracal-mcp-adapter -n caracal --replicas=3\n"})}),"\n",(0,l.jsx)(a.h2,{id:"Optional-Components",children:"Optional Components"}),"\n",(0,l.jsx)(a.h3,{id:"Enable-Autoscaling",children:"Enable Autoscaling"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f hpa.yaml\n"})}),"\n",(0,l.jsx)(a.h3,{id:"Enable-Ingress",children:"Enable Ingress"}),"\n",(0,l.jsxs)(a.p,{children:["Edit ",(0,l.jsx)(a.code,{children:"ingress.yaml"})," and update the hostname, then:"]}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f ingress.yaml\n"})}),"\n",(0,l.jsx)(a.h3,{id:"Enable-Pod-Disruption-Budgets",children:"Enable Pod Disruption Budgets"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f pdb.yaml\n"})}),"\n",(0,l.jsx)(a.h3,{id:"Enable-Prometheus-Monitoring",children:"Enable Prometheus Monitoring"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f servicemonitor.yaml\n"})}),"\n",(0,l.jsx)(a.h2,{id:"Troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(a.h3,{id:"Pods-Not-Starting",children:"Pods Not Starting"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl get pods -n caracal\nkubectl describe pod <pod-name> -n caracal\nkubectl logs <pod-name> -n caracal\n"})}),"\n",(0,l.jsx)(a.h3,{id:"Database-Connection-Issues",children:"Database Connection Issues"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl exec -n caracal caracal-postgres-0 -- pg_isready -U caracal\nkubectl logs -n caracal caracal-postgres-0\n"})}),"\n",(0,l.jsx)(a.h3,{id:"LoadBalancer-Not-Getting-IP",children:"LoadBalancer Not Getting IP"}),"\n",(0,l.jsx)(a.p,{children:"Use NodePort instead:"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Edit gateway-deployment.yaml to use NodePort\nkubectl apply -f gateway-deployment.yaml\nkubectl get svc caracal-gateway -n caracal\n"})}),"\n",(0,l.jsx)(a.h2,{id:"Cleanup",children:"Cleanup"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl delete namespace caracal\n"})}),"\n",(0,l.jsxs)(a.p,{children:[(0,l.jsx)(a.strong,{children:"Warning"}),": This deletes all data including the database."]}),"\n",(0,l.jsx)(a.h2,{id:"Production-Checklist",children:"Production Checklist"}),"\n",(0,l.jsxs)(a.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Use production TLS certificates (not self-signed)"]}),"\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Change default database password"]}),"\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Configure proper storage class for PostgreSQL"]}),"\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Set up database backups"]}),"\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Configure resource limits based on load testing"]}),"\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Enable monitoring (Prometheus, Grafana)"]}),"\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Set up alerting for critical metrics"]}),"\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Configure network policies"]}),"\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Enable pod security policies"]}),"\n",(0,l.jsxs)(a.li,{className:"task-list-item",children:[(0,l.jsx)(a.input,{type:"checkbox",disabled:!0})," ","Test disaster recovery procedures"]}),"\n"]}),"\n",(0,l.jsx)(a.h2,{id:"Next-Steps",children:"Next Steps"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.a,{href:"./kubernetesAdvanced",children:"Kubernetes Advanced"})," - Advanced configuration"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.a,{href:"./production",children:"Production Guide"})," - Production settings"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.a,{href:"./operationalRunbook",children:"Operational Runbook"})," - Operations procedures"]}),"\n"]})]})}function p(e={}){const{wrapper:a}={...(0,t.R)(),...e.components};return a?(0,l.jsx)(a,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453(e,a,n){n.d(a,{R:()=>r,x:()=>c});var s=n(6540);const l={},t=s.createContext(l);function r(e){const a=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(t.Provider,{value:a},e.children)}}}]);