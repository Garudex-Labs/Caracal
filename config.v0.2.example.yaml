# Caracal Core v0.2 Configuration Example
# This file demonstrates all available configuration options for v0.2

# Storage configuration (v0.1 compatibility - file-based storage)
storage:
  agent_registry: ~/.caracal/agents.json
  policy_store: ~/.caracal/policies.json
  ledger: ~/.caracal/ledger.jsonl
  pricebook: ~/.caracal/pricebook.csv
  backup_dir: ~/.caracal/backups
  backup_count: 3

# Database configuration (v0.2 - PostgreSQL backend)
database:
  host: ${DATABASE_HOST:localhost}
  port: ${DATABASE_PORT:5432}
  database: ${DATABASE_NAME:caracal}
  user: ${DATABASE_USER:caracal}
  password: ${DATABASE_PASSWORD}
  pool_size: ${DATABASE_POOL_SIZE:10}
  max_overflow: ${DATABASE_MAX_OVERFLOW:5}
  pool_timeout: ${DATABASE_POOL_TIMEOUT:30}

# Gateway proxy configuration (v0.2)
gateway:
  enabled: ${GATEWAY_ENABLED:false}
  listen_address: ${GATEWAY_LISTEN_ADDRESS:0.0.0.0:8443}
  auth_mode: ${GATEWAY_AUTH_MODE:mtls}  # Options: mtls, jwt, api_key
  
  # TLS configuration
  tls:
    enabled: ${GATEWAY_TLS_ENABLED:true}
    cert_file: ${GATEWAY_TLS_CERT_FILE:/etc/caracal/tls/server.crt}
    key_file: ${GATEWAY_TLS_KEY_FILE:/etc/caracal/tls/server.key}
    ca_file: ${GATEWAY_TLS_CA_FILE:/etc/caracal/tls/ca.crt}
  
  # JWT authentication (when auth_mode is jwt)
  jwt_public_key: ${GATEWAY_JWT_PUBLIC_KEY:/etc/caracal/jwt/public.pem}
  
  # Replay protection
  replay_protection_enabled: ${GATEWAY_REPLAY_PROTECTION_ENABLED:true}
  nonce_cache_ttl: ${GATEWAY_NONCE_CACHE_TTL:300}  # 5 minutes

# Policy cache configuration (v0.2 - for degraded mode)
policy_cache:
  enabled: ${POLICY_CACHE_ENABLED:true}
  ttl_seconds: ${POLICY_CACHE_TTL_SECONDS:60}
  max_size: ${POLICY_CACHE_MAX_SIZE:10000}

# MCP adapter configuration (v0.2)
mcp_adapter:
  enabled: ${MCP_ADAPTER_ENABLED:false}
  listen_address: ${MCP_ADAPTER_LISTEN_ADDRESS:0.0.0.0:8080}
  health_check_enabled: ${MCP_ADAPTER_HEALTH_CHECK_ENABLED:true}
  
  # MCP server URLs (list of MCP servers to connect to)
  mcp_server_urls:
    - http://localhost:3000
    - http://localhost:3001
  
  # Cost calculation rules for MCP operations
  cost_rules:
    - resource_type: "tool_call"
      cost_per_unit: 0.01
      unit: "operation"
    - resource_type: "resource_read"
      cost_per_unit: 0.001
      unit: "kb"

# ASE protocol configuration (v0.2)
ase:
  version: ${ASE_VERSION:1.0.8}
  delegation_token_expiration_seconds: ${ASE_DELEGATION_TOKEN_EXPIRATION_SECONDS:86400}  # 24 hours
  key_algorithm: ${ASE_KEY_ALGORITHM:RS256}  # Options: RS256, ES256
  
  # Provisional charge configuration
  provisional_charges:
    default_expiration_seconds: ${ASE_PROVISIONAL_CHARGE_DEFAULT_EXPIRATION_SECONDS:300}  # 5 minutes
    timeout_minutes: ${ASE_PROVISIONAL_CHARGE_TIMEOUT_MINUTES:60}  # 1 hour maximum
    cleanup_interval_seconds: ${ASE_PROVISIONAL_CHARGE_CLEANUP_INTERVAL_SECONDS:60}
    cleanup_batch_size: ${ASE_PROVISIONAL_CHARGE_CLEANUP_BATCH_SIZE:1000}

# Default values
defaults:
  currency: USD
  time_window: daily
  default_budget: 100.00

# Logging configuration
logging:
  level: ${LOG_LEVEL:INFO}  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
  file: ${LOG_FILE:~/.caracal/caracal.log}
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Performance tuning
performance:
  policy_eval_timeout_ms: 100
  ledger_write_timeout_ms: 10
  file_lock_timeout_s: 5
  max_retries: 3
